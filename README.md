# InternLM-Law

<div align="center">
<img src="https://raw.githubusercontent.com/InternLM/InternLM/main/assets/logo.svg" width="200"/>

  <div> </div>
  <div align="center">
    <b><font size="5">InternLM-Law</font></b>
    <sup>
      <a href="https://internlm.intern-ai.org.cn/">
        <i><font size="4">HOT</font></i>
      </a>
    </sup>
    <div> </div>
  </div>

[![license](https://raw.githubusercontent.com/InternLM/InternLM/main/assets/license.svg)](./LICENSE)

ä¸€ä¸ªä¸­æ–‡é¢†åŸŸæœ€ä¼˜çš„æ³•å¾‹æ¨¡å‹ã€‚

# æ–°é—»
- [2024.05.15] æˆ‘ä»¬å‘å¸ƒäº†InternLM2-Lawï¼Œä¸€ä¸ªä¼˜ç§€çš„ä¸­æ–‡é¢†åŸŸæ³•å¾‹å¤§è¯­è¨€æ¨¡å‹è¶…è¿‡äº†ä¸€ä¼—å…¬å¼€çš„å¤§è¯­è¨€æ¨¡å‹åŒ…æ‹¬å…¬å¼€çš„æ³•å¾‹å¤§æ¨¡å‹å’Œé€šç”¨çš„å¤§è¯­è¨€æ¨¡å‹ä»¥åŠå•†ä¸šå¤§è¯­è¨€æ¨¡å‹GPT4ã€‚


# ä»‹ç»
æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å…¬å¼€ä¸€ä¸ªé¢å‘ä¸­æ–‡å¸æ³•é¢†åŸŸçš„å¤§è¯­è¨€æ¨¡å‹InternLM-Lawï¼Œå¹¶ä¸”å…¬å¼€äº†å¸æ³•é¢†åŸŸçš„é•¿æ–‡æœ¬æµ‹è¯•æ•°æ®é›†å’Œä¸»è§‚è¯„æµ‹æ•°æ®é›†ã€‚æˆ‘ä»¬çš„æ³•å¾‹å¤§è¯­è¨€æ¨¡å‹ä¸»è¦æœ‰ä»¥ä¸‹çš„ç‰¹ç‚¹ï¼š

- **ä¸€ä¸ª7Bè§„æ¨¡çš„æ³•å¾‹å¤§è¯­è¨€æ¨¡å‹ï¼Œåœ¨æ³•å¾‹ä»»åŠ¡ä¸Šçš„è¡¨ç°ä¼˜äºChatGPTç”šè‡³GPT4ã€‚** InternLM-Lawæ˜¯åŸºäºInternLM2-Chatæ¨¡å‹ä¸”é‡‡ç”¨äº†çº¦100wæ¡é«˜è´¨é‡å’Œå¤šæ ·åŒ–çš„ç›‘ç£æ•°æ®è¿›è¡Œæœ‰ç›‘ç£å¾®è°ƒã€‚å¹¶ä¸”é‡‡ç”¨äº†ä¸¤é˜¶æ®µçš„SFTè®­ç»ƒç­–ç•¥ï¼Œæ¥å¹³è¡¡å®¢è§‚æ€§èƒ½å’Œä¸»è§‚èƒ½åŠ›ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é•¿åº¦è®¾ç½®ä¸º32Kï¼Œè®©æ¨¡å‹èƒ½å¤Ÿå¤„ç†æ³•å¾‹é¢†åŸŸä¸­çš„é•¿æ–‡æœ¬ã€‚

- **ä¸€ä¸ªèƒ½å¤Ÿè°ƒç”¨å·¥å…·æ¥è¾…åŠ©è§£å†³æ³•å¾‹é—®é¢˜çš„æ¨¡å‹ã€‚**ä¸ä»…ä»…è‡ªèº«æœ‰ç€ä¼˜ç§€çš„èƒ½åŠ›ï¼Œåœ¨è§£å†³é—®é¢˜ä¸Šï¼Œæˆ‘ä»¬çš„æ¨¡å‹è¿˜èƒ½å¤Ÿå€ŸåŠ©å·¥å…·æ¥æ›´åŠ ç²¾ç¡®çš„å®Œæˆç›¸å…³çš„ä»»åŠ¡ã€‚æ¯”å¦‚åœ¨éœ€è¦æ•°å€¼è®¡ç®—çš„ä»»åŠ¡ä¸Šï¼Œæ¨¡å‹èƒ½å¤Ÿç¼–å†™Pythonä»£ç æ¥æ±‚è§£æ³•å¾‹é¢†åŸŸçš„æ•°å€¼è®¡ç®—é—®é¢˜ï¼Œè¿›ä¸€æ­¥æå‡æ¨¡å‹åœ¨ä¸€äº›é—®é¢˜ä¸Šçš„å‡†ç¡®ç‡ã€‚æˆ‘ä»¬çš„æ¨¡å‹è¿˜èƒ½å’Œç°æœ‰çš„æµè¡Œæ¡†æ¶ç»“åˆï¼Œè®©å®ƒçš„æ•ˆæœæ›´åŠ çš„å‡†ç¡®ã€‚
- **èƒ½å¤ŸæœåŠ¡å¤šç§åœºæ™¯çš„æ³•å¾‹å¤§è¯­è¨€æ¨¡å‹ã€‚**åœ¨æ™ºæ…§å¸æ³•é¢†åŸŸä¸­ï¼Œæœ‰å¾ˆå¤šå—ä¼—ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ä¸ä»…ä»…èƒ½å¤Ÿä¸ºæ³•å¾‹ä¸“ä¸šäººå‘˜æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä¸ºæ™®é€šçš„ç”¨æˆ·æœåŠ¡ã€‚å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„å®Œæˆä¸€äº›æ³•å¾‹ç›¸å…³çš„NLPä»»åŠ¡ï¼Œè¿™è®©ä»–èƒ½å¤ŸæœåŠ¡äºä¹‹å‰çš„å„ç§å¸æ³•ç³»ç»Ÿï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæä¾›è‰¯å¥½çš„æ³•å¾‹å’¨è¯¢æœåŠ¡ï¼Œä¸ºå¤šç§å¤šæ ·çš„ç¾¤ä½“æä¾›æœåŠ¡ã€‚

![](./figs/law_bench_radar_plot.png)

# æ¨¡å‹
**InternLM2-Law-7B** æ˜¯ä¸€ä¸ªSFTæ¨¡å‹ã€‚

| Model                | Model Type | Transformers(HF) | Release Date |
| -------------------- | ---------- | ------------------------------------------------------------ |
| **InternLM2-Law-7B** | SFT        | [ğŸ¤—internlm/internlm2-law-7b](https://huggingface.co/internlm/internlm2-law-7b) | 2024-05-11   |


# æ€§èƒ½è¡¨ç°

æˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬çš„æ¨¡å‹åœ¨LawBenchä¸Šçš„ç»“æœï¼ŒLawBenchæ˜¯ä¸€ä¸ªå…¨é¢ç³»ç»Ÿçš„æµ‹è¯•å¤§è¯­è¨€æ¨¡å‹å¸æ³•èƒ½åŠ›çš„æ•°æ®é›†ã€‚å®ƒåŒ…å«20ä¸ªä»»åŠ¡ï¼Œä»è®°å¿†ã€ç†è§£ã€åº”ç”¨ä¸‰ä¸ªè®¤çŸ¥å±‚é¢å¯¹å¤§è¯­è¨€æ¨¡å‹çš„æ³•å¾‹èƒ½åŠ›è¿›è¡Œåˆ†æã€‚æˆ‘ä»¬æŒ‘é€‰äº†æœ€æ–°çš„ä¸­æ–‡é¢†åŸŸé€šç”¨å¤§è¯­è¨€æ¨¡å‹å’Œæ³•å¾‹é¢†åŸŸå¤§è¯­è¨€æ¨¡å‹è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶ä¸”ä¸ç›®å‰æœ€å¼ºçš„å•†ä¸šæ¨¡å‹GPT4è¿›è¡Œæ¯”è¾ƒã€‚ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„æ¨¡å‹åœ¨ä¸‰ä¸ªç»´åº¦ä¸Šå…¨é¢è¶…è¿‡äº†ç›®å‰å…¬å¼€çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬æ›´å¤§è§„æ¨¡çš„ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹Qwen-1.5-72Bå’ŒGPT4ã€‚

| Models             | Model Type | Memorization | Understanding | Application | Avg  |
| ------------------ | ---------- | ------------ | ------------- | ----------- | ---- |
| GPT4               | General  | 35.29/36.01 | 54.41/56.48 | 54.05/55.01 | 52.35/53.85 |
| Qwen-1.5-7B        | General    | 19.16/19.00 | 39.19/43.62 | 49.75/50.40 | 41.41/43.87 |
| InternLM2-Chat-7B  | General    | 31.62/32.02 | 45.00/48.33 | 50.33/52.91 | 45.80/48.53 |
| Qwen-1.5-72B    | General    | 52.77/50.06 | 52.16/54.92 | 61.24/62.28 | 55.85/57.38 |
| Lawyer-LLaMA-13B | Legal      | 17.77/11.82 | 18.94/18.89 | 35.19/30.99 | 25.32/23.02 |
| ChatLaw-13B | Legal | 21.63/22.69 | 28.21/30.22 | 41.23/38.13 | 32.76/32.63 |
| Fuzimingcha-6B | Legal      | 16.51/16.51 | 30.10/23.83 | 40.86/38.04 | 33.05/28.78 |
| DISC-Law-7B | Legal | 38.05/37.02 | 36.43/38.07 | 48.94/53.14 | 41.60/43.99 |
| InternLM-Law(Ours) | Legal | **63.72/64.95** | **71.81/71.58** | **63.57/63.46** | **67.71/67.67** |

## ä¸»è§‚æ€§èƒ½è¡¨ç°
ä¸€ä¸ªæ³•å¾‹å¤§è¯­è¨€æ¨¡å‹å¸¦ç»™äººçš„é—®ç­”ä½“éªŒä¹Ÿéå¸¸é‡è¦ï¼Œæˆ‘ä»¬æ ¹æ®æ³•å¾‹é¢†åŸŸå¸¸è§çš„å‡ ç±»å¼€æ”¾é¢†åŸŸé—®é¢˜æ¥æˆ‘ä»¬æ„å»ºäº†ä¸€äº›æ³•å¾‹é¢†åŸŸçš„å¼€æ”¾é—®ç­”é—®é¢˜ï¼Œè¿™äº›é—®é¢˜æ¶µç›–äº†æ³•å¾‹é¢†åŸŸé—®ç­”ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©GPT4ä½œä¸ºåŸºå‡†ï¼Œé€šè¿‡GPT4æ¥æ¯”è¾ƒè¿™äº›æ³•å¾‹æ¨¡å‹çš„å›ç­”ä¸GPT4å›å¤çš„å¥½åæ¥è®¡ç®—æ¨¡å‹ç›¸æ¯”äºåŸºç¡€æ¨¡å‹çš„èƒœç‡ã€‚
| Model                | win rate |
| -------------------- | -------- |
| Lawyer-LLaMA         | 0.0      |
| ChatLaw              | 0.0      |
| Fuzimingcha          | 5.0      |
| DISC-Law             | 11.7     |
| **InternLM2-Law-7B** | **46.7** |
## æ³•å¾‹é•¿æ–‡æœ¬è¡¨ç°

æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªæ³•å¾‹é•¿æ–‡æœ¬è¯„æµ‹æ•°æ®é›†ï¼Œåœ¨æ³•å®˜å¤„ç†äº‹åŠ¡é¢†åŸŸä¸­æœ€å¸¸è§çš„æ˜¯é˜…è¯»è£åˆ¤æ–‡ä¹¦ï¼Œå¹¶ä¸”ä»è£åˆ¤æ–‡ä¹¦ä¸­è·å–å…³é”®ä¿¡æ¯ã€‚è€Œä¸€äº›è£åˆ¤æ–‡ä¹¦éå¸¸é•¿ï¼Œä»è¿™äº›è¶…é•¿æ–‡æœ¬ä¸­æå–å…³é”®ä¿¡æ¯å˜å¾—éå¸¸å›°éš¾ã€‚æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªæ³•å¾‹é¢†åŸŸçš„é•¿æ–‡æœ¬æµ‹è¯•æ•°æ®é›†æ¥æµ‹è¯•æ¨¡å‹åœ¨è¿™äº›è¶…é•¿æ–‡æœ¬ä¸­å‡†ç¡®å¬å›ç›¸å…³ä¿¡æ¯çš„èƒ½åŠ›ã€‚ä¸ºäº†è®©æ¨¡å‹èƒ½å¤Ÿè¾“å…¥è¿™äº›æ³•å¾‹é•¿æ–‡æœ¬ï¼Œæˆ‘ä»¬é‡‡ç”¨LMDeployæ¨ç†å¼•æ“æ¥è®©æ¨¡å‹èƒ½å¤Ÿæ¥å—è¿™äº›è¶…é•¿æ–‡æœ¬è¾“å…¥ã€‚æˆ‘ä»¬å±•ç¤ºäº†å…¬å¼€çš„æ³•å¾‹æ¨¡å‹åœ¨æ³•å¾‹é•¿æ–‡æœ¬ä¿¡æ¯å¬å›ä¸Šçš„è¡¨ç°ã€‚
| Model                | F1 score  |
| -------------------- | --------- |
| Lawyer-LLaMA         | N/A       |
| ChatLaw              | N/A       |
| Fuzimingcha          | N/A       |
| DISC-Law             | 17.52     |
| **InternLM2-Law-7B** | **84.73** |


# è¯„æµ‹

ä½ ä»¬èƒ½å¤Ÿåœ¨å„ç§æ•°æ®é›†ä¸Šè¯„æµ‹InternLM2-Lawï¼Œæ¯”å¦‚LawBenchã€‚é€šè¿‡ [OpenCompass](https://github.com/open-compass/opencompass) ä½ åªéœ€è¦ä¸€è¡Œå‘½ä»¤è¡Œå°±èƒ½å¤Ÿå®Œæˆè¯„æµ‹ã€‚åœ¨å®‰è£…å®ŒOpencompassä¹‹åä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æµ‹è¯•æ¨¡å‹åœ¨LawBenchä¸Šçš„ç»“æœï¼š

```bash
python run.py --models hf_internlm2_law_7b --datasets lawbench
```

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„configæ–‡ä»¶ï¼Œå¹¶é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤æ¥æµ‹è¯•æ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„æ•ˆæœï¼š

```bash
python run.py config/eval_internlm_law_chat.py
```

# æ¨ç†

æˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥ç›´æ¥é€šè¿‡Huggingfaceè°ƒç”¨ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡æ¨ç†åç«¯å¦‚LMDeployæ¥è¿›è¡Œéƒ¨ç½²ã€‚

## LMDeploy

æˆ‘ä»¬å»ºè®®ä½¿ç”¨ [LMDeploy](https://github.com/InternLM/LMDeploy)(>=0.2.1) æ¥è¿›è¡Œæ¨ç†ã€‚
```python
from lmdeploy import pipeline, TurbomindEngineConfig, ChatTemplateConfig

backend_config = TurbomindEngineConfig(model_name='internlm2-chat-7b', tp=1, cache_max_entry_count=0.3)
chat_template = ChatTemplateConfig(model_name='internlm2-chat-7b', system='', eosys='', meta_instruction='')
pipe = pipeline(model_path='internlm/internlm2-law-7b', chat_template_config=chat_template, backend_config=backend_config)

problem = 'è¯·ä½ å‘Šè¯‰æˆ‘ä¸­å›½å®ªæ³•ç¬¬ä¸€æ¡æ˜¯ä»€ä¹ˆï¼Ÿ'
result = pipe([problem], request_output_len=1024, top_k=1)
```

## Huggingface
```python
import torch
from transformers import AutoTokenizer, AutoModelForCausalLM
tokenizer = AutoTokenizer.from_pretrained("internlm/internlm2-law-7b", trust_remote_code=True)
# Set `torch_dtype=torch.float16` to load model in float16, otherwise it will be loaded as float32 and might cause OOM Error.
model = AutoModelForCausalLM.from_pretrained("internlm/internlm2-law-7b", trust_remote_code=True, torch_dtype=torch.float16).cuda()
model = model.eval()
response, history = model.chat(tokenizer, "è¯·ä½ å‘Šè¯‰æˆ‘ä¸­å›½çš„å®ªæ³•ç¬¬ä¸€æ¡çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ", history=[], meta_instruction="")
print(response)
```

# ä¾‹å­
æˆ‘ä»¬åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­å±•ç¤ºäº†æˆ‘ä»¬çš„æ¨¡å‹åœ¨æ³•å¾‹å’¨è¯¢ä»»åŠ¡ä¸Šçš„ä¾‹å­å’Œä¸€ä¸ªç¼–å†™ä»£ç è®¡ç®—çŠ¯ç½ªé‡‘é¢è®¡ç®—çš„ä¾‹å­ã€‚

![](./figs/legal_consultation.JPG)

æˆ‘ä»¬çš„æ¨¡å‹åœ¨å›ç­”æ³•å¾‹å’¨è¯¢é—®é¢˜æ—¶ï¼Œåœ¨å›å¤é£æ ¼ä¸Šæ¯”å…¶ä»–æ¨¡å‹æ›´åŠ çš„å¥½ï¼Œå®ƒåœ¨å›å¤æ—¶æ›´åŠ è§„æ•´æœ‰æ¡ç†ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¼•ç”¨ç›¸å…³çš„æ³•æ¡ï¼Œå¹¶ä¸”æ¨æµ‹å¯èƒ½çš„æƒ…å†µå¹¶åšè¯¦ç»†çš„åˆ†æã€‚è€Œå…¶ä»–çš„å¤§è¯­è¨€æ¨¡å‹åœ¨å›å¤æ—¶å›ç­”çš„å†…å®¹è¿‡äºç®€çŸ­ï¼Œå¹¶ä¸ä¼šåˆ†æå¯èƒ½çš„æƒ…å½¢ï¼Œç”¨æˆ·çš„å®é™…æ„Ÿå—ä¸ä½³ã€‚

![](./figs/tool_usage.JPG)


æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹åœ¨è®­ç»ƒæ—¶å¹¶æ²¡æœ‰ä¸€äº›é€šè¿‡Pythonæ±‚è§£æ³•å¾‹é¢†åŸŸé‡‘é¢è®¡ç®—çš„è®­ç»ƒæ•°æ®ã€‚è€Œæˆ‘ä»¬çš„æ¨¡å‹å°†ç¼–å†™ä»£ç æ±‚è§£é—®é¢˜çš„é€šç”¨çš„èƒ½åŠ›è¿ç§»åˆ°æ±‚è§£æ³•å¾‹é¢†åŸŸé—®é¢˜ä¸Šï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨Pythonä»£ç çš„æ–¹å¼æ¥æ±‚è§£æ³•å¾‹é¢†åŸŸä¸­çŠ¯ç½ªé‡‘é¢è®¡ç®—é—®é¢˜ã€‚

æˆ‘ä»¬åœ¨æ­¤å¤„ä»…ä»…å±•ç¤ºäº†æˆ‘ä»¬å¤§è¯­è¨€æ¨¡å‹ä½œä¸ºåŸºç¡€æ¨¡å‹çš„èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿç»“åˆä¸€äº›æµè¡Œçš„æ¡†æ¶å¦‚LangChainã€LAgentæ¥æ›´å¥½çš„ä½¿ç”¨ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®å¤§å®¶åœ¨ä½¿ç”¨æ—¶è‡ªå·±æ„å»ºä¸€ä¸ªé€‚ç”¨äºä½¿ç”¨åœºæ™¯çš„æ£€ç´¢æ•°æ®åº“ï¼Œè¿™ä¸ä»…ä»…èƒ½å¤Ÿæœ‰æ•ˆçš„æå‡æ¨¡å‹å›å¤çš„å‡†ç¡®æ€§ï¼Œæ›´èƒ½å¤Ÿè®©ä»–æ›´åŠ å¥½çš„å®Œæˆä½ ä»¬çš„ä»»åŠ¡ã€‚




# å¾®è°ƒå’Œå…¶ä»–
å¦‚æœä½ æƒ³åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥çš„å¾®è°ƒæ¥å¢å¼ºå®ƒçš„èƒ½åŠ›ï¼Œä½ å¯ä»¥ä½¿ç”¨Xtuneræ¡†æ¶æˆ–è€…å‚è€ƒ[InternLM](https://github.com/InternLM/InternLM/tree/main)ã€‚

# å·²çŸ¥é—®é¢˜
å°½ç®¡æˆ‘ä»¬åšäº†å¾ˆå¤šçš„åŠªåŠ›æ¥å‡å°‘æ¨¡å‹ä¸­è¾“å‡ºçš„å¹»è§‰å’Œä¸€äº›ä¸çœŸå®çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ¨¡å‹ä¸å…¶ä»–å¤§è¯­è¨€æ¨¡å‹ç›¸åŒä»ç„¶ä¼šè¾“å‡ºä¸€äº›ä¸å‡†ç¡®çš„ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬å¼ºçƒˆå»ºè®®ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶æ­é…æµè¡Œçš„æ£€ç´¢å¢å¼ºæ¡†æ¶æ¥æå‡æ¨¡å‹çš„äº‹å®èƒ½åŠ›ã€‚



# å¼•ç”¨å’ŒæŠ€æœ¯æŠ¥å‘Š
```
@misc{InternLM2-Law,
    title={InternLM-Law: An Open Source Chinese Legal Large Language Model},
    author={InternLM-Law Contributors},
    howpublished = {\url{https://github.com/InternLM/InternLM-Law}},
    year={2024}
}
```
